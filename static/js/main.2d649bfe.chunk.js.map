{"version":3,"sources":["App.js","UploadIFS.js","Router.js","index.js"],"names":["Web3","require","web3","givenProvider","WrapperStyled","styled","div","ButtonStyleed","button","ButtonBuyStyled","App","useState","isBuy","setIsBuy","totalSupply","setTotalSupply","badieSupply","setBadieSupply","dateSale","setDateSale","loading","setLoading","setMessage","useEffect","window","addEventListener","a","ethereum","enable","then","eth","getAccounts","account","console","log","actionSmartConstract","e","currentProvider","alert","senderAddress","ABIERC721","ercConstract","Contract","process","methods","getPrice","call","from","saleActive","tokenURI","tokenId","tokenByIndex","tokenIndex","d1","Date","d2","getTime","onBuyToken","mintBadie","send","contractAddress","catch","error","transactionHash","getTransaction","buyToken","onClick","create","urlSource","client","WrapperFormStyled","PreViewStyled","UploadIPFS","image","setImage","url","setUrl","onUploadFile","add","pin","content","cid","toString","type","id","name","accept","onChange","event","target","files","reader","FileReader","onload","result","readAsDataURL","src","alt","NavStyled","nav","RouterApp","to","path","ReactDOM","render","StrictMode","Router","document","getElementById"],"mappings":"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","file":"static/js/main.2d649bfe.chunk.js","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport styled from \"styled-components\";\nimport ABIERC721 from \"./untils/abiToken.json\";\nconst Web3 = require(\"web3\");\nlet web3 = new Web3(\n  Web3.givenProvider ||\n    \"https://rinkeby.infura.io/v3/1c37394c71d748369948038cfbc3e79\"\n);\nconst dateSaleEnd = 1628045829534 + 30 * 3600 * 24 * 1000;\nfunction App() {\n  const [isBuy, setIsBuy] = useState(false);\n  const [totalSupply, setTotalSupply] = useState(0);\n  const [badieSupply, setBadieSupply] = useState(0);\n  const [dateSale, setDateSale] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [message, setMessage] = useState(\"\");\n  useEffect(() => {\n    window.addEventListener(\"load\", async () => {\n      if (window.ethereum) {\n        web3 = new Web3(window.ethereum);\n        try {\n          window.ethereum.enable().then(async function async() {\n            const account = await web3.eth.getAccounts();\n            console.log(\"account\", account);\n            actionSmartConstract(account[0]);\n          });\n        } catch (e) {\n          // User has denied account access to DApp...\n        }\n      }\n      // Legacy DApp Browsers\n      else if (window.web3) {\n        web3 = new Web3(window.web3.currentProvider);\n        console.log(\"web3\", web3);\n      }\n      // Non-DApp Browsers\n      else {\n        alert(\"You have to install MetaMask !\");\n      }\n    });\n  }, []);\n\n  const actionSmartConstract = async (senderAddress) => {\n    console.log(\"ABIERC721\", ABIERC721);\n    const ercConstract = new web3.eth.Contract(\n      ABIERC721,\n      \"0x6590D6f9B8120aa30C36b9DF38CAAf7cA51175Dc\"\n    );\n    console.log(\n      \"process.env.ercConstract\",\n      process.env.REACT_APP_CONSTRACT_ADDRESS\n    );\n    const price = await ercConstract.methods.getPrice().call({\n      from: senderAddress,\n    });\n    const saleActive = await ercConstract.methods.saleActive().call({\n      from: senderAddress,\n    });\n    if (saleActive === true) {\n      setIsBuy(true);\n    }\n    //badieSupply  //badieSupply\n    const totalSupply = await ercConstract.methods.totalSupply().call({\n      from: senderAddress,\n    });\n    setTotalSupply(totalSupply);\n    const badieSupply = await ercConstract.methods.totalSupply().call({\n      from: senderAddress,\n    });\n    setBadieSupply(badieSupply);\n    const tokenId = await ercConstract.methods.tokenURI(2).call({\n      from: senderAddress,\n    });\n    const tokenIndex = await ercConstract.methods.tokenByIndex(1).call({\n      from: senderAddress,\n    });\n    console.log(\"badieSupply\", badieSupply);\n    console.log(\"tokenId\", tokenId);\n    console.log(\"tokenIndex\", tokenIndex);\n    const d1 = new Date();\n    const d2 = new Date(dateSaleEnd);\n    console.log(new Date().getTime());\n    console.log(\"d1\", d1);\n    console.log(\"d2\", d2);\n    console.log(\"d1.getTime() <= d2.getTime()\", d1.getTime() <= d2.getTime());\n    if (d1.getTime() <= d2.getTime()) {\n      setDateSale(true);\n    }\n    setLoading(false);\n  };\n\n  const onBuyToken = async () => {\n    if (window.ethereum) {\n      const ercConstract = new web3.eth.Contract(\n        ABIERC721,\n        \"0x6590D6f9B8120aa30C36b9DF38CAAf7cA51175Dc\"\n      );\n      const account = await web3.eth.getAccounts();\n      console.log(\"account\", account);\n      const buyToken = await ercConstract.methods\n        .mintBadie(15)\n        .send({\n          from: account[0],\n          contractAddress: \"0x6590D6f9B8120aa30C36b9DF38CAAf7cA51175Dc\",\n        })\n        .catch((error) => {\n          console.log(\"error here\", typeof error);\n          if (error) {\n            console.log(\"error detail\", error.transactionHash);\n            web3.eth\n              .getTransaction(error && error.transactionHash)\n              .then(console.log);\n          }\n          setMessage(\"\");\n        });\n      console.log(\"buyToken\", buyToken);\n    }\n  };\n\n  if (loading) {\n    return <WrapperStyled>Loading....</WrapperStyled>;\n  }\n  if (isBuy) {\n    return (\n      <WrapperStyled>\n        {totalSupply > badieSupply ? (\n          <ButtonStyleed>Sold Out</ButtonStyleed>\n        ) : (\n          <ButtonBuyStyled onClick={onBuyToken}>BUY NOW</ButtonBuyStyled>\n        )}\n      </WrapperStyled>\n    );\n  }\n  if (!isBuy) {\n    return (\n      <WrapperStyled>\n        {dateSale ? (\n          <ButtonStyleed>Sale Finished</ButtonStyleed>\n        ) : (\n          <ButtonStyleed>Sale not yet active</ButtonStyleed>\n        )}\n      </WrapperStyled>\n    );\n  }\n}\nconst WrapperStyled = styled.div`\n  width: 100%;\n  margin-top: 100px;\n  display: flex;\n  justify-content: center;\n`;\nconst ButtonStyleed = styled.button`\n  width: 200px;\n  height: 50px;\n  background: red;\n  color: #fff;\n  font-weight: bold;\n  border: none;\n  cursor: pointer;\n  text-transform: uppercase;\n  :hover {\n    background: #333;\n  }\n`;\n\nconst ButtonBuyStyled = styled.button`\n  width: 200px;\n  height: 50px;\n  background: green;\n  color: #fff;\n  font-weight: bold;\n  border: none;\n  cursor: pointer;\n  text-transform: uppercase;\n  :hover {\n    background: #333;\n  }\n`;\n\nexport default App;\n","import React, { useState } from \"react\";\nimport styled from \"styled-components\";\nconst { create, urlSource } = require(\"ipfs-http-client\");\n// khởi tạo connection\nconst client = create(\"/ip4/127.0.0.1/tcp/5001\");\n// sử dụng pinata gateway để truy xuất tài nguyên \nconst getwayIPFS = \"https://gateway.pinata.cloud/ipfs\";\n\n// UploadIPFS đây là một hàm onchange để upload file và tạo một preview image\nconst UploadIPFS = () => {\n  // hàm setSate cho react \n  const [image, setImage] = useState(null);\n  const [url, setUrl] = useState(null);\n\n  const onFileChange = (event) => {\n    if (event.target.files && event.target.files[0]) {\n      let reader = new FileReader();\n      reader.onload = (e) => {\n        setImage(e.target.result);\n      };\n      // create image url kiểu base64\n      reader.readAsDataURL(event.target.files[0]);\n    }\n  };\n  // thự hiện upload lên mạng network\n  const onUploadFile = async () => {\n    // ham upload source lên ipfs network\n    const content = await client.add(urlSource(image), { pin: true });\n    // thực hiện get content hash CID duy nhất trả về từ network\n    const cid = content.cid.toString();\n    setUrl(`${getwayIPFS}/${cid}`);\n  };\n  console.log(\"url\", url);\n  return (\n    <WrapperFormStyled>\n      <h1>Upload Image to IPFS</h1>\n      <input\n        type=\"file\"\n        id=\"avatar\"\n        name=\"avatar\"\n        accept=\"image/png, image/jpeg\"\n        onChange={onFileChange}\n      />\n      <PreViewStyled>\n        {image && <img src={image} alt=\"#\" id=\"target\" />}\n      </PreViewStyled>\n      <ButtonBuyStyled onClick={onUploadFile}>Upload IFS</ButtonBuyStyled>\n      {url && <img alt=\"\" src={url} />}\n    </WrapperFormStyled>\n  );\n};\n// sử dụng styled-component để styled css cho site\nconst WrapperFormStyled = styled.div`\n  width: 400px;\n  margin: 0 auto;\n  height: 300px;\n`;\nconst PreViewStyled = styled.div`\n  margin-top: 30px;\n  width: 300px;\n  height: auto;\n  img {\n    width: 100%;\n  }\n`;\nconst ButtonBuyStyled = styled.button`\n  width: 200px;\n  height: 50px;\n  background: green;\n  color: #fff;\n  font-weight: bold;\n  border: none;\n  cursor: pointer;\n  text-transform: uppercase;\n  :hover {\n    background: #333;\n  }\n`;\nexport default UploadIPFS;\n","import React from \"react\";\nimport { BrowserRouter as Router, Switch, Route, Link } from \"react-router-dom\";\nimport TokenSale from \"./App\";\n// import một component Uload vào Router.js\nimport UloadIPFS from \"./UploadIFS\";\nimport styled from \"styled-components\";\n\n// ở đây mình có sử dụng react-router-dom để chia thành nhiều page\n\nconst RouterApp = () => {\n  return (\n    <Router>\n      <NavStyled>\n        <ul>\n          <li>\n            <Link to=\"/\">Token Sale</Link>\n          </li>\n          <li>\n            <Link to=\"/ipfs\">Upload IPFS</Link>\n          </li>\n          <li>\n            <Link to=\"/users\">Users</Link>\n          </li>\n        </ul>\n      </NavStyled>\n      <div>\n        <Switch>\n        <Route path=\"/ipfs\">\n            <UloadIPFS />\n          </Route>\n          <Route path=\"/\">\n            <TokenSale />\n          </Route>\n        </Switch>\n      </div>\n    </Router>\n  );\n};\nconst NavStyled = styled.nav`\n  display: flex;\n  width: 100%;\n  background: #ccc;\n  ul {\n    list-style: none;\n    display: flex;\n    li {\n      padding: 0 20px;\n      a {\n        text-decoration: none;\n        text-transform: uppercase;\n        color: #000;\n        hover: {\n          color: red;\n        }\n      }\n    }\n  }\n`;\n\nexport default RouterApp;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport Router from './Router';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Router />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}